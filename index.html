<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My GitHub Commit Stats</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f4f4f4;
            color: #333;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #0366d6;
            text-align: center;
            margin-bottom: 30px;
        }
        .loading {
            text-align: center;
            font-style: italic;
            color: #666;
        }
        .stats-section {
            margin-top: 20px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        .repo-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #e9f7ff;
            border-left: 5px solid #0366d6;
            border-radius: 4px;
        }
        .repo-item strong {
            color: #0366d6;
        }
        ul {
            list-style: none;
            padding: 0;
        }
        li {
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>My GitHub Commit Statistics</h1>
        <p class="loading">Loading commit data... This might take a moment.</p>
        <div id="stats-output">
            </div>
    </div>

    <script>
        // REPLACE WITH YOUR GITHUB USERNAME
        const GITHUB_USERNAME = 'nitawa'; 

        // IMPORTANT: For personal use and higher rate limits, you might need a Personal Access Token.
        // If you use a PAT, uncomment the line below and replace 'YOUR_PERSONAL_ACCESS_TOKEN'
        // NEVER hardcode a PAT if this file is publicly accessible in a repository other than your own.
        // For public repos, stick to unauthenticated requests, but be aware of lower rate limits.
        // const GITHUB_TOKEN = 'YOUR_PERSONAL_ACCESS_TOKEN'; 

        const GITHUB_API_BASE = 'https://api.github.com';

        async function fetchGitHubData(url) {
            const headers = {
                'Accept': 'application/vnd.github.v3+json'
            };
            // if (GITHUB_TOKEN) {
            //     headers['Authorization'] = `token ${GITHUB_TOKEN}`;
            // }

            try {
                const response = await fetch(url, { headers });
                if (!response.ok) {
                    // Handle rate limiting specifically
                    if (response.status === 403 && response.headers.get('X-RateLimit-Remaining') === '0') {
                        console.error('GitHub API Rate Limit Exceeded!');
                        alert('GitHub API Rate Limit Exceeded! Please try again later or use a Personal Access Token.');
                        return null;
                    }
                    throw new Error(`GitHub API error: ${response.statusText} (${response.status}) for ${url}`);
                }
                return await response.json();
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        async function getUserRepositories(username) {
            let allRepos = [];
            let page = 1;
            let perPage = 100; // Max per page
            let url = `${GITHUB_API_BASE}/users/${username}/repos?per_page=${perPage}&page=${page}`;
            let repos;

            do {
                repos = await fetchGitHubData(url);
                if (repos) {
                    allRepos = allRepos.concat(repos);
                    page++;
                    url = `${GITHUB_API_BASE}/users/${username}/repos?per_page=${perPage}&page=${page}`;
                } else {
                    break;
                }
            } while (repos && repos.length === perPage); // Continue if there might be more pages

            return allRepos;
        }

        async function getCommitsForRepo(username, repoName) {
            // We only need the first page for the total count of commits by the user
            // Getting all commits can be very slow and hit rate limits.
            const url = `${GITHUB_API_BASE}/repos/${username}/${repoName}/commits?author=${username}&per_page=1`; 
            const response = await fetchGitHubData(url);
            
            if (response && response.length > 0 && response[0].author && response[0].author.login === username) {
                // If there's at least one commit by the user, check the Link header for total pages
                const linkHeader = response.headers.get('Link');
                if (linkHeader) {
                    const lastPageMatch = linkHeader.match(/&page=(\d+)>; rel="last"/);
                    if (lastPageMatch) {
                        return parseInt(lastPageMatch[1], 10); // Total number of pages of commits
                    }
                }
                // If no 'last' link header (e.g., only one page of commits), assume 1 commit
                return 1; 
            }
            return 0; // No commits by this user in this repo
        }


        async function getCommitStats() {
            const statsOutput = document.getElementById('stats-output');
            statsOutput.innerHTML = '<p class="loading">Fetching repositories...</p>';

            const repos = await getUserRepositories(GITHUB_USERNAME);
            if (!repos || repos.length === 0) {
                statsOutput.innerHTML = '<p>Could not fetch repositories or no repositories found for this user.</p>';
                return;
            }

            let totalCommits = 0;
            let reposWithCommits = 0;
            const repoCommitDetails = [];

            statsOutput.innerHTML = `<p class="loading">Found ${repos.length} repositories. Fetching commit data...</p>`;

            for (const repo of repos) {
                const commitCount = await getCommitsForRepo(GITHUB_USERNAME, repo.name);
                if (commitCount > 0) {
                    totalCommits += commitCount;
                    reposWithCommits++;
                    repoCommitDetails.push({ name: repo.name, commits: commitCount, url: repo.html_url });
                }
                // Update loading message periodically
                statsOutput.innerHTML = `<p class="loading">Processing ${repoCommitDetails.length} / ${repos.length} repositories...</p>`;
            }

            statsOutput.innerHTML = `
                <div class="stats-section">
                    <h2>Overall Stats</h2>
                    <ul>
                        <li><strong>Total Commits (estimated):</strong> ${totalCommits}</li>
                        <li><strong>Repositories Contributed To:</strong> ${reposWithCommits}</li>
                        <li><strong>Total Repositories Owned:</strong> ${repos.length}</li>
                    </ul>
                </div>
                <div class="stats-section">
                    <h2>Commits per Repository</h2>
                    <ul id="repo-list"></ul>
                </div>
            `;

            const repoList = document.getElementById('repo-list');
            if (repoCommitDetails.length > 0) {
                // Sort by commit count descending
                repoCommitDetails.sort((a, b) => b.commits - a.commits); 
                repoCommitDetails.forEach(detail => {
                    const li = document.createElement('li');
                    li.className = 'repo-item';
                    li.innerHTML = `<strong><a href="${detail.url}" target="_blank">${detail.name}</a>:</strong> ${detail.commits} commits`;
                    repoList.appendChild(li);
                });
            } else {
                repoList.innerHTML = '<li>No commits found in any owned repositories.</li>';
            }
        }

        // Run the function when the page loads
        document.addEventListener('DOMContentLoaded', getCommitStats);
    </script>
</body>
</html>
